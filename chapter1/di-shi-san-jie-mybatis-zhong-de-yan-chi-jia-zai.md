## 第十三节 Mybatis 中的延迟加载

问题：在一对多中，当有一个用户，它有100个账户。

在查询用户的时候，要不要把关联的账户查出来？
* 在查询用户时，用户下的账户信息应该是，什么时候使用，什么时候查询的。

在查询账户的时候，要不要把关联的用户查出来？
* 在查询账户时，账户的所属用户信息应该是随着账户查询时一起查询出来。

	
**什么是延迟加载**
* 在真正使用数据时才发起查询，不用的时候不查询。按需加载（懒加载）
  * 好处：先从单表查询，需要时再从关联表去关联查询，大大提高数据库性能，因为查询单表要比关联查询多张表速度要快。
  * 坏处：因为只有当需要用到数据时，才会进行数据库查询，这样在大批量数据查询时，因为查询工作也要消耗时间，所以可能造成用户等待时间变长，造成用户体验下降。
  
**什么是立即加载**
* 不管用不用，只要一调用方法，马上发起查询。

在对应的四种表关系中：一对多，多对一，一对一，多对多
* 一对多，多对多：通常情况下我们都是采用延迟加载。
* 多对一，一对一：通常情况下我们都是采用立即加载。


**实现需求**
* 查询账户(Account)信息并且关联查询用户(User)信息。如果先查询账户(Account)信息即可满足要求，当需要查询用户(User)信息时再查询用户(User)信息。把对用户(User)信息的按需去查询就是延迟加载。
* 使用了 resultMap 来实现**一对一，一对多，多对多**关系的操作。主要是通过 `association、collection` 实现一对一及一对多映射。`association、collection` 具备延迟加载功能。


### 13.1 使用 assocation 实现延迟加载

1. 在 SqlMapConfig.xml 的 configuration 标签内添加延迟设置：

```xml
<!--配置参数-->
<settings>
    <!--开启Mybatis支持延迟加载-->
    <setting name="lazyLoadingEnabled" value="true"/>
    <!---->
    <setting name="aggressiveLazyLoading" value="false"></setting>
</settings>
```

2. 账户的持久层 DAO 接口

```java
public interface IAccountDao {
  
    List<Account> findAll();
}
```

3. 账户的持久层映射文件

  


4. 


### 13.2 使用 Collection 实现延迟加载 










